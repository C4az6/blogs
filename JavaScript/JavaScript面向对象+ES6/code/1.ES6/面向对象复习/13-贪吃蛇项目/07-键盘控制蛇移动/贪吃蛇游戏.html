<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script src="./js/map.js"></script>
  <script src="./js/food.js"></script>
  <script src="./js/snake.js"></script>
  <script>
    // 构造函数 - 用于游戏对象
    function Game() {
      // 游戏属性 - 地图
      this.map = new Map();
      // 游戏属性 - 食物
      this.food = new Food({
        map: this.map
      });
      // 游戏属性 - 蛇
      this.snake = new Snake({
        map: this.map,
        direction: 'right'
      });

      // 调用开始游戏的方法 start
      this.start();
      this.bindKey();
    }

    // 原型对象 - 添加方法 - start 游戏开始
    Game.prototype.start = function () {
      // 游戏开始的时候，蛇动起来
      that = this;
      this.timer = setInterval(function () {
        that.snake.move();

        // 添加边界判断，超过边界则弹窗提示game over！
        // 获取蛇头对象
        var snakeHead = that.snake.body[0];
        // 如果满足下面4个条件就清除定时器
        if(snakeHead.left >= that.map.width || snakeHead.left < 0 || snakeHead.top < 0 || snakeHead.top >= that.map.height) {
          console.log("触发边界检测！！！")
          clearInterval(that.timer);
          // alert('Game Over!');
        }
      }, 150);
    }

    // 原型对象 - 添加方法 - bindKey 绑定键盘按下事件
    Game.prototype.bindKey = function() {
      that = this;
      document.body.addEventListener('keydown', function(e) {
        if(e.keyCode===37) {
          that.snake.direction = 'left';
        }else if(e.keyCode===38) {
          that.snake.direction = 'up';
        }else if(e.keyCode===39) {
          that.snake.direction = 'right';
        }else if(e.keyCode===40) {
          that.snake.direction = 'down';
        }
      })
    }

    // 实例化游戏对象，实例的时候同时创建 地图，食物，蛇 三个对象
    var game = new Game();
    // 检查对象的数据
  </script>
</body>

</html>